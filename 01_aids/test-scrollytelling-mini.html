<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollytelling Mini Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script src="../shared/assets/js/libs/d3-labeler.js"></script>
    <link rel="stylesheet" href="../shared/assets/css/shared-base.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .test-info { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; z-index: 1000; max-width: 300px; }
        .step { min-height: 100vh; }
        .chart-test { width: 400px; height: 300px; border: 2px dashed #ccc; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- ãƒ†ã‚¹ãƒˆæƒ…å ±è¡¨ç¤º -->
    <div class="test-info" id="test-info">
        <div><strong>Scrollytelling Mini Test</strong></div>
        <div id="app-status">App: èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="data-status">Data: å¾…æ©Ÿä¸­</div>
        <div id="scroll-status">Scroll: å¾…æ©Ÿä¸­</div>
        <div id="chart-status">Chart: å¾…æ©Ÿä¸­</div>
        <div id="current-step">Step: -</div>
    </div>

    <!-- ç°¡ç•¥ç‰ˆãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="container" class="relative min-h-screen" style="padding-top: 60px;">
        <!-- å›ºå®šèƒŒæ™¯ï¼ˆãƒãƒ£ãƒ¼ãƒˆãƒ»åœ°å›³ã‚¨ãƒªã‚¢ï¼‰ -->
        <div id="fixed-background" class="fixed inset-0 w-full h-full">
            <!-- ãƒãƒ£ãƒ¼ãƒˆã‚¨ãƒªã‚¢ -->
            <div id="chart-container" class="absolute inset-0 flex items-center justify-center">
                <div id="chart"></div>
            </div>
            
            <!-- åœ°å›³ã‚¨ãƒªã‚¢ -->
            <div id="map-container" class="absolute inset-0">
                <div id="map" class="w-full h-full"></div>
            </div>
            
            <!-- ç”»åƒã‚¨ãƒªã‚¢ -->
            <div id="image-container" class="absolute inset-0 flex items-center justify-center">
                <img id="image" class="max-w-full max-h-full object-contain" src="" alt="" />
            </div>
        </div>

        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="scroll-content" class="relative z-10">
            <!-- ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒƒãƒ— -->
            <div class="step" data-step="0">
                <div class="w-full min-h-screen flex items-center justify-center bg-blue-100">
                    <div class="text-center">
                        <h1 class="text-4xl font-bold mb-4">ğŸ§ª Scrollytelling Test</h1>
                        <p class="text-lg">Step 0: ã‚¢ãƒ—ãƒªåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</p>
                        <div class="chart-test">ãƒãƒ£ãƒ¼ãƒˆã‚¨ãƒªã‚¢ (ãƒ†ã‚¹ãƒˆ)</div>
                    </div>
                </div>
            </div>

            <div class="step" data-step="1">
                <div class="w-full min-h-screen flex items-center justify-center bg-green-100">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">ğŸ“Š ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
                        <p class="text-lg">Step 1: è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</p>
                        <div class="chart-test">ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ (ãƒ†ã‚¹ãƒˆ)</div>
                    </div>
                </div>
            </div>

            <div class="step" data-step="2">
                <div class="w-full min-h-screen flex items-center justify-center bg-yellow-100">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">ğŸ—ºï¸ åœ°å›³ãƒ†ã‚¹ãƒˆ</h2>
                        <p class="text-lg">Step 2: åœ°å›³è¡¨ç¤ºãƒ»éƒ½å¸‚ãƒ•ã‚©ãƒ¼ã‚«ã‚¹</p>
                        <div class="chart-test">åœ°å›³è¡¨ç¤ºã‚¨ãƒªã‚¢ (ãƒ†ã‚¹ãƒˆ)</div>
                    </div>
                </div>
            </div>

            <div class="step" data-step="3">
                <div class="w-full min-h-screen flex items-center justify-center bg-purple-100">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">ğŸ“ˆ ãƒãƒ£ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ</h2>
                        <p class="text-lg">Step 3: D3.jsãƒãƒ£ãƒ¼ãƒˆæç”»</p>
                        <div class="chart-test">ãƒãƒ£ãƒ¼ãƒˆæç”»ã‚¨ãƒªã‚¢ (ãƒ†ã‚¹ãƒˆ)</div>
                    </div>
                </div>
            </div>

            <div class="step" data-step="4">
                <div class="w-full min-h-screen flex items-center justify-center bg-red-100">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">âœ… å®Œäº†ãƒ†ã‚¹ãƒˆ</h2>
                        <p class="text-lg">Step 4: Scrollytellingå‹•ä½œç¢ºèªå®Œäº†</p>
                        <div class="chart-test">ãƒ†ã‚¹ãƒˆå®Œäº†</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <!-- æ„ŸæŸ“ç—‡ã‚¿ã‚¤ãƒ—è¨­å®šï¼ˆæœ€åˆã«è¨­å®šï¼‰ -->
    <script>
        window.DISEASE_TYPE = 'aids';
        
        // ãƒ†ã‚¹ãƒˆæƒ…å ±æ›´æ–°
        function updateTestInfo(key, value, status = '') {
            const element = document.getElementById(key);
            if (element) {
                const statusIcon = status === 'success' ? 'âœ…' : status === 'error' ? 'âŒ' : status === 'warning' ? 'âš ï¸' : 'ğŸ“‹';
                element.innerHTML = `${statusIcon} ${key.replace('-status', '')}: ${value}`;
            }
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            updateTestInfo('app-status', `Error: ${event.error.message}`, 'error');
        });
        
        updateTestInfo('app-status', 'JSèª­ã¿è¾¼ã¿é–‹å§‹...', 'warning');
    </script>
    
    <!-- æ„ŸæŸ“ç—‡è¨­å®šï¼ˆConfigLoaderã‚ˆã‚Šå‰ã«èª­ã¿è¾¼ã‚€ï¼‰ -->
    <script src="../shared/assets/js/config/disease-config.js"></script>
    
    <!-- è¨­å®šèª­ã¿è¾¼ã¿ -->
    <script src="../shared/assets/js/utils/config-loader.js"></script>
    
    <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š -->
    <script src="../shared/assets/js/config/defaults.js"></script>
    
    <!-- å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
    <script src="../shared/assets/js/utils/app-constants.js"></script>
    <script src="../shared/assets/js/utils/base-manager.js"></script>
    <script src="../shared/assets/js/utils/svg-helper.js"></script>
    <script src="../shared/assets/js/utils/error-handler.js"></script>
    
    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="../shared/assets/js/pubsub.js"></script>
    <script src="../shared/assets/js/chart-manager.js"></script>
    <script src="../shared/assets/js/map-manager.js"></script>
    <script src="../shared/assets/js/image-manager.js"></script>
    <script src="../shared/assets/js/main.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runScrollytellingTest() {
            try {
                updateTestInfo('app-status', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...', 'warning');
                
                // åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯
                if (window.DiseaseDetector && window.ConfigLoader && window.ScrollytellingApp) {
                    updateTestInfo('app-status', 'ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸', 'success');
                } else {
                    throw new Error('Core systems missing');
                }
                
                // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                updateTestInfo('data-status', 'èª­ã¿è¾¼ã¿ä¸­...', 'warning');
                await window.ConfigLoader.loadAll();
                updateTestInfo('data-status', 'è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                
                // ScrollytellingAppã®å®Ÿè¡Œ
                updateTestInfo('scroll-status', 'ã‚¢ãƒ—ãƒªåˆæœŸåŒ–ä¸­...', 'warning');
                const app = new window.ScrollytellingApp();
                
                // ç°¡å˜ãªScrollamaã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                const scroller = scrollama();
                scroller
                    .setup({
                        step: '.step',
                        offset: 0.5,
                        debug: false
                    })
                    .onStepEnter((response) => {
                        updateTestInfo('current-step', `${response.index} (${response.direction})`, 'success');
                        updateTestInfo('scroll-status', 'Scrollamaå‹•ä½œä¸­', 'success');
                    });
                
                updateTestInfo('chart-status', 'ãƒãƒ£ãƒ¼ãƒˆæº–å‚™å®Œäº†', 'success');
                
            } catch (error) {
                console.error('Test failed:', error);
                updateTestInfo('app-status', `Failed: ${error.message}`, 'error');
            }
        }
        
        // ãƒ†ã‚¹ãƒˆé–‹å§‹
        window.addEventListener('load', () => {
            setTimeout(runScrollytellingTest, 1000);
        });
    </script>
</body>
</html>