<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disease System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 5px; background: #f0f0f0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Disease System Test</h1>
    
    <div class="test-section">
        <h2>1. æ„ŸæŸ“ç—‡æ¤œå‡ºãƒ†ã‚¹ãƒˆ</h2>
        <div id="disease-detection-result" class="result">ãƒ†ã‚¹ãƒˆä¸­...</div>
    </div>
    
    <div class="test-section">
        <h2>2. ãƒ‘ã‚¹è§£æ±ºãƒ†ã‚¹ãƒˆ</h2>
        <div id="path-resolution-result" class="result">ãƒ†ã‚¹ãƒˆä¸­...</div>
    </div>
    
    <div class="test-section">
        <h2>3. ConfigLoaderãƒ†ã‚¹ãƒˆ</h2>
        <div id="config-loader-result" class="result">ãƒ†ã‚¹ãƒˆä¸­...</div>
    </div>
    
    <div class="test-section">
        <h2>4. CSSå¤‰æ•°ãƒ†ã‚¹ãƒˆ</h2>
        <div id="css-variables-result" class="result">ãƒ†ã‚¹ãƒˆä¸­...</div>
        <div id="color-preview" style="width: 100px; height: 50px; border: 1px solid #000; margin: 10px 0;"></div>
    </div>

    <!-- æ„ŸæŸ“ç—‡è¨­å®š -->
    <script>
        window.DISEASE_TYPE = 'aids';
    </script>
    
    <!-- æ„ŸæŸ“ç—‡ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="assets/js/config/disease-config.js"></script>
    <script src="assets/js/utils/config-loader.js"></script>

    <!-- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¿½åŠ 
        console.log('ğŸ” Debug Info:');
        console.log('window.DISEASE_TYPE:', window.DISEASE_TYPE);
        console.log('window.DiseaseDetector:', window.DiseaseDetector);
        console.log('window.ConfigLoader:', window.ConfigLoader);
        
        async function runTests() {
            let allTestsPassed = true;
            
            // 1. æ„ŸæŸ“ç—‡æ¤œå‡ºãƒ†ã‚¹ãƒˆ
            try {
                const diseaseType = window.DiseaseDetector.getDiseaseType();
                const diseaseConfig = window.DiseaseDetector.getDiseaseConfig();
                
                if (diseaseType === 'aids' && diseaseConfig.name === 'HIV/ã‚¨ã‚¤ã‚ºã¨ã®é—˜ã„') {
                    document.getElementById('disease-detection-result').innerHTML = 
                        `âœ… æˆåŠŸ: ${diseaseType} â†’ ${diseaseConfig.name}`;
                    document.getElementById('disease-detection-result').className = 'result success';
                } else {
                    throw new Error(`Expected 'aids', got '${diseaseType}'`);
                }
            } catch (error) {
                document.getElementById('disease-detection-result').innerHTML = 
                    `âŒ å¤±æ•—: ${error.message}`;
                document.getElementById('disease-detection-result').className = 'result error';
                allTestsPassed = false;
            }
            
            // 2. ãƒ‘ã‚¹è§£æ±ºãƒ†ã‚¹ãƒˆ
            try {
                // DiseaseDetectorã®ãƒ†ã‚¹ãƒˆ
                const configPath = window.DiseaseDetector.resolveConfigPath('test.json');
                const dataPath = window.DiseaseDetector.resolveDataPath('test.csv');
                const assetPath = window.DiseaseDetector.resolveAssetPath('test.js');
                
                // ConfigLoaderã®ãƒ†ã‚¹ãƒˆï¼ˆé‡è¤‡ãƒ‘ã‚¹å¯¾å¿œï¼‰
                const configLoaderDataPath1 = window.ConfigLoader.resolveDataPath('test.csv');
                const configLoaderDataPath2 = window.ConfigLoader.resolveDataPath('data/test.csv');
                const configLoaderAssetPath1 = window.ConfigLoader.resolveAssetPath('test.js');
                const configLoaderAssetPath2 = window.ConfigLoader.resolveAssetPath('assets/test.js');
                
                if (configPath === 'config/test.json' && 
                    dataPath === 'data/test.csv' && 
                    assetPath === 'assets/test.js' &&
                    configLoaderDataPath1 === 'data/test.csv' &&
                    configLoaderDataPath2 === 'data/test.csv' &&
                    configLoaderAssetPath1 === 'assets/test.js' &&
                    configLoaderAssetPath2 === 'assets/test.js') {
                    document.getElementById('path-resolution-result').innerHTML = 
                        `âœ… æˆåŠŸ:<br>DiseaseDetector - Config: ${configPath}<br>Data: ${dataPath}<br>Asset: ${assetPath}<br>ConfigLoaderé‡è¤‡å¯¾å¿œ - OK`;
                    document.getElementById('path-resolution-result').className = 'result success';
                } else {
                    throw new Error(`ãƒ‘ã‚¹è§£æ±ºã‚¨ãƒ©ãƒ¼: ${JSON.stringify({
                        configLoaderDataPath1, configLoaderDataPath2, 
                        configLoaderAssetPath1, configLoaderAssetPath2
                    })}`);
                }
            } catch (error) {
                document.getElementById('path-resolution-result').innerHTML = 
                    `âŒ å¤±æ•—: ${error.message}`;
                document.getElementById('path-resolution-result').className = 'result error';
                allTestsPassed = false;
            }
            
            // 3. ConfigLoaderãƒ†ã‚¹ãƒˆ
            try {
                await window.ConfigLoader.loadAll();
                const diseaseConfig = window.ConfigLoader.getDiseaseConfig();
                const legacyConfig = window.ConfigLoader.getLegacyCompatibleConfig();
                
                if (diseaseConfig && diseaseConfig.id === 'aids' && legacyConfig.steps) {
                    document.getElementById('config-loader-result').innerHTML = 
                        `âœ… æˆåŠŸ: ConfigLoaderçµ±åˆå®Œäº†<br>æ„ŸæŸ“ç—‡: ${diseaseConfig.name}<br>Steps: ${legacyConfig.steps.length}å€‹`;
                    document.getElementById('config-loader-result').className = 'result success';
                } else {
                    throw new Error(`è¨­å®šèª­ã¿è¾¼ã¿å¤±æ•— - Disease: ${diseaseConfig?.id}, Steps: ${legacyConfig?.steps?.length}`);
                }
            } catch (error) {
                document.getElementById('config-loader-result').innerHTML = 
                    `âŒ å¤±æ•—: ${error.message}<br>è©³ç´°: ${error.stack?.split('\n')[0]}`;
                document.getElementById('config-loader-result').className = 'result error';
                allTestsPassed = false;
                console.error('ConfigLoader Test Error:', error);
            }
            
            // 4. CSSå¤‰æ•°ãƒ†ã‚¹ãƒˆ
            try {
                const primaryColor = getComputedStyle(document.documentElement)
                    .getPropertyValue('--disease-color-primary').trim();
                const systemPrimaryColor = getComputedStyle(document.documentElement)
                    .getPropertyValue('--color-primary').trim();
                
                if (primaryColor === '#ff6b6b' && systemPrimaryColor === '#ff6b6b') {
                    document.getElementById('css-variables-result').innerHTML = 
                        `âœ… æˆåŠŸ: CSSå¤‰æ•°è¨­å®šå®Œäº† (${primaryColor})`;
                    document.getElementById('css-variables-result').className = 'result success';
                    
                    // ã‚«ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    document.getElementById('color-preview').style.backgroundColor = primaryColor;
                } else {
                    throw new Error(`æœŸå¾…: #ff6b6b, å®Ÿéš›: disease=${primaryColor}, system=${systemPrimaryColor}`);
                }
            } catch (error) {
                document.getElementById('css-variables-result').innerHTML = 
                    `âŒ å¤±æ•—: ${error.message}`;
                document.getElementById('css-variables-result').className = 'result error';
                allTestsPassed = false;
            }
            
            // ç·åˆçµæœ
            if (allTestsPassed) {
                document.title = 'âœ… All Tests Passed - Disease System Test';
                console.log('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†ï¼');
            } else {
                document.title = 'âŒ Some Tests Failed - Disease System Test';
                console.log('âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•—ã€‚è¦ä¿®æ­£ã€‚');
            }
        }
        
        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500); // DOMã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤
        });
    </script>
</body>
</html>